<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Crop image in Circle. With the help of this tool image can be cropped to circle." />
<meta name="keywords" content="online image cropper,crop in circle, free image editor, crop image, put filter on image" />      
  <!-- Font Awesome -->
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
<!-- Bootstrap core CSS -->
<link href="css/bootstrap.min.css" rel="stylesheet">
<!-- Material Design Bootstrap -->
<!-- <link href="css/mdb.min.css" rel="stylesheet"> -->
	<link rel="stylesheet" href="css/cropper.css" />
	<link rel="stylesheet" href="css/style.css">
	<link rel="stylesheet" href="css/tsongcss.css">
       <link type="text/css" href="https://uicdn.toast.com/tui-color-picker/v2.2.3/tui-color-picker.css" rel="stylesheet">
        <link type="text/css" href="css/tui-image-editor/tui-image-editor.css" rel="stylesheet">	  
	<title>Utilityfreetool - Free Online Utility Free Tool for you.</title>
	<style>

.cropper-crop-box, .cropper-view-box {
    border-radius: 50%;
}

.cropper-view-box {
    box-shadow: 0 0 0 1px #39f;
    outline: 0;
}

.cropper-face {
  background-color:inherit !important;
}

.cropper-dashed, .cropper-point.point-se, .cropper-point.point-sw, .cropper-point.point-nw,   .cropper-point.point-ne, .cropper-line {
  display:none !important;
}

.cropper-view-box {
  outline:inherit !important;
}
		

		._menuc.active {
			background-color: #0099CC;
		}
		
	  </style>
  </head>
  <body>
    <nav  class="navbar navbar-expand-lg navbar-dark">
		<div class="container">
		  <a href="index.html" class="navbar-brand text-dark _font" title="chopimg"><span class="text-danger"><i class="fas fa-tools"></i> UtilityFreeTool</span></a>
  
			  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapseImgTools"
			  aria-controls="basicExampleNav" aria-expanded="false" aria-label="Toggle navigation">
			  <i class="fas fa-bars text-dark"></i>
			  </button>		
		</div>
	  </nav>
		<div class=" mt-3 container">
			<div class="t-grid bg-success">
					<div class="t-grid-4 text-center p-3 _menus active"><a href="square.html" class="text-white font-weight-bold ">Square</a></div>
					<div class="t-grid-4 text-center p-3 _menur active"><a href="rectangle.html" class="text-white font-weight-bold ">Rectangle</a></div>
					<div class="t-grid-4 text-center p-3 _menuc active"><a href="circle.html" class="text-white font-weight-bold ">Circle</a></div>
				</div>
	  </div>
	
	<h2 class="font-weight-bold text-center m-5 _font">Crop in Circle</h2>
	<div class="_wrapper d-flex">
		
		<!-- Side Menu -->
			

			<!-- Main Content -->
				<div class="container">
					<main>
<!-- Below are a series of inputs which allow file selection and interaction with the cropper api -->
<div class="upload-btn-wrapper">

<label class="btn btn-outline-danger waves-effect btn-upload">
	
	<i class="far fa-image"></i>
	&nbsp;
	Upload image to crop<input type="file" id="fileInput" accept="image/*" style="display: none"/></label>
	
</div>	

<div id="canvas_wrapper">
  <canvas id="canvas">
   		
  </canvas>
</div>		

						
							
							<div class="t-grid ">
								<div class="t-grid-3 g-t"> 
								<button type="button" id="btnCrop" class="btn btn-success btn-task btn-block" data-toggle="modal" data-target="#myModal"><i class="fas fa-crop" ></i> Crop</button>		
								</div>
								<div class="t-grid-3 g-t">
								<button type="button" id="btnRestore" class="btn btn-success btn-task btn-block"><i class="fas fa-sync"></i> Reset</button>
								</div>
								<div class="t-grid-3 g-t">
								<button type="button"  class="btn btn-success btn-task _undo btn-block"><i class="fas fa-undo"></i> Rotate(L)</button>
								</div>
								<div class="t-grid-3 g-t">
								<button type="button"  class="btn btn-success btn-task _redo btn-block"><i class="fas fa-redo"></i> Rotate(R)</button>
								</div>
								
							</div>
<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModal"
  aria-hidden="true" data-backdrop="static" data-keyboard="false">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
<!--
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel"></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
-->
      <div class="modal-body">
        <div id="result" class="mt-2 mb-2"></div>
							
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <a class="btn btn-warning" id="btnDownload" download>Save Image</a>
      </div>
    </div>
  </div>
</div>							
							
					</main>
				</div>		
		</div>
<div class="container mt-4">
	  <h4 class="font-weight-bold _font_h">How It Works?</h4>
		<div class="row">
			<div class="col-md-4">
				<div class="row">
					<div class="col-md-2">
						<h3 class="font-weight-bold _font_h">01|</h3>
						<hr>
					</div>
					<div class="col-md-10">
						<p class="font-weight-bold _font_p">Click on the File Button to load Image into Canvas.</p>					
					</div>
				</div>
			</div>
			<div class="col-md-4">
				<div class="row">
					<div class="col-md-2">
						<h3 class="font-weight-bold _font_h">02|</h3>
						<hr>
					</div>
					<div class="col-md-10">
						<p class="font-weight-bold _font_p">Use the toolkit under the Canvas to Crop, Reset and Rotate Image.</p>					
					</div>
				</div>
			</div>
			<div class="col-md-4">
				<div class="row">
					<div class="col-md-2">
						<h3 class="font-weight-bold _font_h">03|</h3>
						<hr>
					</div>
					<div class="col-md-10">
						<p class="font-weight-bold _font_p">After finishing the process download the Image from pop up.</p>					
					</div>
				</div>
			</div>
		</div>	  
</div>	
<footer class="page-footer bg-dark text-white p-3">
    <div class="container">
      <div class="row">
        <div class="col-md-4">
          <h4 class="_font_h">Quick Links</h4>
            <div class="text-left">
				<a href="rectangle.html" class="text-white _font_p" title="Crop Image">Crop Image</a><br>
				<a href="base64Encode.html" class="text-white _font_p" title="Convert Image">Convert Image</a><br>
				<a href="filter.html" class="text-white _font_p" title="Image Filters">Image Filters</a>
          </div>
        </div>
        <div class="col-md-4">
          <h4 class="_font_h">About</h4>
          <p class="_font_p">UtilityFreeTool is an online Free tool where you can use this tools to make your task easier. 
			  There are various tools where you can speed your task without wasting your time.
		  </p>
        </div>
        <div class="col-md-4">
          <h4 class="_font_h">Contact</h4>
          <a class="_font_p">iamdemigod123@gmail.com</a>
        </div>
      </div>
    </div>
  </footer>       
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
	<!-- JQuery -->
	  
<script type="text/javascript" src="js/jquery.min.js"></script>
<!-- Bootstrap tooltips -->
<script type="text/javascript" src="js/popper.min.js"></script>
<!-- Bootstrap core JavaScript -->
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<!-- MDB core JavaScript -->
<script  type="module" src="js/mdb.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jQuery-slimScroll/1.3.8/jquery.slimscroll.min.js" integrity="sha256-qE/6vdSYzQu9lgosKxhFplETvWvqAAlmAuR+yPh/0SI=" crossorigin="anonymous"></script>
	<script  src="js/script.js"></script>	
	  <script src="cordova.js"></script>	
	  <script src="js/cropper.js"></script>
	  <script src="js/jquery-cropper.js"></script>

	  <script>
			var canvas  = $("#canvas"),
				context = canvas.get(0).getContext("2d"),
				$result = $('#result'),
		  		upload =  document.querySelector('#fileInput');
		  
		  var imgname;
    function getRoundedCanvas(sourceCanvas) {
      var canvas = document.createElement('canvas');
      var context = canvas.getContext('2d');
      var width = sourceCanvas.width;
      var height = sourceCanvas.height;

      canvas.width = width;
      canvas.height = height;
      context.imageSmoothingEnabled = true;
      context.drawImage(sourceCanvas, 0, 0, width, height);
      context.globalCompositeOperation = 'destination-in';
      context.beginPath();
      context.arc(width / 2, height / 2, Math.min(width, height) / 2, 0, 2 * Math.PI, true);
      context.fill();
      return canvas;
    }
		  
 window.addEventListener('DOMContentLoaded', function () {
			//$('#fileInput').on('change', function(){
				upload.addEventListener('change', function(){
				if (this.files && this.files[0]) {
				  if ( this.files[0].type.match(/^image\//) ) {
					var reader = new FileReader();
					   var croppable = false;
					   reader.onload = function(evt) {
						   $result.empty();
					   var img = new Image();
						   //alert(img);
					   img.onload = function() {
						 context.canvas.height = img.height;
						 context.canvas.width  = img.width;
//						 roundedImage(img,context, 0, 0, canvas.width, canvas.height, 100);
//							context.clip();
						   context.drawImage(img, 0, 0);
//						   context.restore();
//								
						   	var cropper = canvas.cropper({
									aspectRatio: 1,
									viewMode: 1,
									ready: function () {
									  croppable = true;
									},						 
						 }); 
						   
						   
						   
						   
						   
						 $('#btnCrop').on('click',function(event) {
							 event.preventDefault();
							 //alert(1);
							 imgname = "rcropped_" + upload.files[0].name;
							 var croppedCanvas;
								var roundedCanvas;
								var imgTemp;
							 var roundimage;
							 var croppedCHOPIMGataURL = canvas.cropper('getCroppedCanvas').toDataURL("image/png"); 
							var img = new Image();
							 
							 //alert(croppedCHOPIMGataURL.height);
							         imgTemp = document.createElement('img');
							 			imgTemp.setAttribute('id','_imgTemp');
        							imgTemp.src = croppedCHOPIMGataURL;
							 
							 img.onload = function(){

       											 context.canvas.height = img.height;
						 context.canvas.width  = img.width;
									//	alert(img);
        							roundedCanvas = getRoundedCanvas(img);	
								         roundedImage = document.createElement('img');
											roundedImage.src = roundedCanvas.toDataURL();
											result.innerHTML = '';
											result.appendChild(roundedImage);
								 //$('#btnDownload').attr('href', roundedCanvas.toDataURL());
								 roundimage = roundedCanvas.toDataURL();
								 
							function b64toBlob(b64Data, contentType, sliceSize) {
        contentType = contentType || '';
        sliceSize = sliceSize || 512;

        var byteCharacters = atob(b64Data);
        var byteArrays = [];

        for (var offset = 0; offset < byteCharacters.length; offset += sliceSize) {
            var slice = byteCharacters.slice(offset, offset + sliceSize);

            var byteNumbers = new Array(slice.length);
            for (var i = 0; i < slice.length; i++) {
                byteNumbers[i] = slice.charCodeAt(i);
            }

            var byteArray = new Uint8Array(byteNumbers);

            byteArrays.push(byteArray);
        }

      var blob = new Blob(byteArrays, {type: contentType});
      return blob;
}                           
						 
						   
						 

			var myBase64 = roundimage;
// Split the base64 string in data and contentType
var block = myBase64.split(";");
// Get the content type
var contentType = block[0].split(":")[1];// In this case "image/png"
// get the real base64 content of the file
var realData = block[1].split(",")[1];// In this case "iVBORw0KGg...."

// The path where the file will be created

// The name of your file, note that you need to know if is .png,.jpeg etc
var filename = imgname;
	
document.getElementById("btnDownload").addEventListener("click", function(){  
          //  console.log("Starting to write the file :3");						

	var DataBlob = b64toBlob(realData,contentType);
  let e;
  // Create link
  const link = document.createElement("a");

  // Set props
  link.download = filename;
  link.href = roundimage;
  // New mouse event
  e = new MouseEvent("click");
  // Dispatch event
  link.dispatchEvent(e);
									
        });					
												 
								 
							 }
							 img.src = croppedCHOPIMGataURL;
							 
			 
							//End of btn crop  
						 });
						 $('#btnRestore').click(function() {
						   canvas.cropper('reset');
						   $result.empty();
						 });
						   
						   
						 $('._undo').click(function(){
							 cropper.cropper('rotate', -90);
						 });  
						 $('._redo').click(function(){
							 cropper.cropper('rotate', 90);
						 });  
					   };
						   canvas.cropper('destroy'); 
					   img.src = evt.target.result;
							};
					reader.readAsDataURL(this.files[0]);
				  }
				  else {
					alert("Invalid file type! Please select an image file.");
				  }
				}
				else {
				  alert('No file(s) selected.');
				}
			});	  
	  
		  });
	  </script>
 </body>
</html>
